{% extends "base.html" %}
{% load custom_filters %}

{% block title %}Analyze Text - VeriFact{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1 class="mb-4">Analyze Text for Fake News</h1>
  <p class="lead">
    Enter any text below to analyze it for credibility using our lightweight detection models.
  </p>

  <div class="card mb-5">
    <div class="card-body">
      <form method="post">
        {% csrf_token %}
        <div class="mb-3">
          <label for="text" class="form-label">Text to Analyze</label>
          <textarea class="form-control" id="text" name="text" rows="8" required></textarea>
        </div>

        <div class="mb-3">
          <label for="model" class="form-label">Select Model</label>
          <select class="form-select" id="model" name="model">
            {% for model in models %}
              <option value="{{ model.key }}">{{ model.name }}</option>
            {% endfor %}
          </select>
        </div>

        <button type="submit" class="btn btn-primary">Analyze Text</button>
      </form>
    </div>
  </div>

  {% if results %}
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Analysis Results</h5>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <h6>Credibility Score:</h6>
          <div class="progress" style="height: 25px;">
            <div class="progress-bar
              {% if results.credibility_score > 0.7 %}bg-success
              {% elif results.credibility_score > 0.3 %}bg-warning
              {% else %}bg-danger{% endif %}"
              role="progressbar"
              style="width: {{ results.credibility_score|floatformat:2|multiply:100 }}%;"
              aria-valuenow="{{ results.credibility_score|floatformat:2|multiply:100 }}"
              aria-valuemin="0"
              aria-valuemax="100">
              {{ results.credibility_score|floatformat:2|multiply:100 }}%
            </div>
          </div>
        </div>

        <div class="mb-3 text-center">
          <h6>Assessment:</h6>
          <h4>
            {% if results.category == 'credible' %}
              <span class="badge bg-success">Credible</span>
            {% elif results.category == 'mixed' %}
              <span class="badge bg-warning">Mixed Credibility</span>
            {% else %}
              <span class="badge bg-danger">Fake</span>
            {% endif %}
          </h4>
        </div>

        <hr>

        <div class="row">
          <div class="col-md-6">
            <p><strong>Model used:</strong> {{ results.model_name }}</p>
          </div>
          <div class="col-md-6">
            <p><strong>Processing time:</strong> {{ results.processing_time|floatformat:2 }} seconds</p>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}